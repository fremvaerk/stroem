# Global image tag override. Defaults to Chart.appVersion if not set.
imageTag: ""

server:
  image:
    repository: ghcr.io/fremvaerk/stroem-server
    tag: ""
  replicas: 1
  service:
    type: ClusterIP
    port: 8080
  # Full server-config.yaml content — passed as-is to the ConfigMap.
  # Secrets (db.url, worker_token, auth secrets) should be set via extraSecretEnv
  # using STROEM__ env var overrides instead of putting them here.
  config:
    listen: "0.0.0.0:8080"
    db:
      url: "postgres://stroem:stroem@postgres:5432/stroem"
    log_storage:
      local_dir: /var/stroem/logs
    workspaces: {}
    # Example:
    #   default:
    #     type: folder
    #     path: /workspace
    worker_token: "change-me-in-production"
  # Extra env vars injected as a Secret (for STROEM__ overrides of sensitive values)
  extraSecretEnv: {}
  #  STROEM__DB__URL: "postgres://real-user:real-pass@rds:5432/stroem"
  #  STROEM__WORKER_TOKEN: "production-secret"
  #  STROEM__AUTH__JWT_SECRET: "jwt-secret"
  #  STROEM__AUTH__REFRESH_SECRET: "refresh-secret"
  # Extra plain env vars
  extraEnv: {}
  # Extra volumes and mounts (e.g., for SSH deploy keys)
  extraVolumes: []
  extraVolumeMounts: []
  resources: {}

worker:
  image:
    repository: ghcr.io/fremvaerk/stroem-worker
    tag: ""
  replicas: 2
  # Full worker-config.yaml content — passed as-is to the ConfigMap.
  # server_url and worker_name are auto-injected via env vars.
  config:
    server_url: "http://stroem-server:8080"
    worker_token: "change-me-in-production"
    worker_name: "k8s-worker"
    max_concurrent: 4
    poll_interval_secs: 2
    workspace_cache_dir: /var/stroem/workspace-cache
    capabilities:
      - shell
  # Extra env vars injected as a Secret
  extraSecretEnv: {}
  #  STROEM__WORKER_TOKEN: "production-secret"
  # Extra plain env vars
  extraEnv: {}
  # Docker-in-Docker sidecar for DockerRunner
  dind:
    enabled: false
    image: docker:27-dind
    resources: {}
  resources: {}

# RBAC for pod creation (needed for KubeRunner)
rbac:
  create: true
  # Extra namespaces where the worker can create pods (for KubeRunner).
  # A Role + RoleBinding will be created in each listed namespace.
  # The release namespace is always included automatically.
  namespaces: []
  #  - jobs
  #  - staging-jobs

serviceAccount:
  create: true
  name: ""
  annotations: {}
  #  eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/stroem-s3

# Optional Ingress for UI and webhook triggers
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: stroem.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: stroem-tls
  #    hosts:
  #      - stroem.example.com
